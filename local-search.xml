<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>android权限处理</title>
    <link href="/2020/01/20/android%E6%9D%83%E9%99%90%E5%A4%84%E7%90%86/"/>
    <url>/2020/01/20/android%E6%9D%83%E9%99%90%E5%A4%84%E7%90%86/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>android屏幕适配.md</title>
    <link href="/2020/01/20/android%E5%B1%8F%E5%B9%95%E9%80%82%E9%85%8D/"/>
    <url>/2020/01/20/android%E5%B1%8F%E5%B9%95%E9%80%82%E9%85%8D/</url>
    
    <content type="html"><![CDATA[<h1 id="基础概念"><a href="#基础概念" class="headerlink" title="基础概念"></a>基础概念</h1><h2 id="屏幕尺寸"><a href="#屏幕尺寸" class="headerlink" title="屏幕尺寸"></a>屏幕尺寸</h2><p>屏幕对角线长度。单位英寸。1英寸≈2.54㎝。</p><h2 id="屏幕分辨率"><a href="#屏幕分辨率" class="headerlink" title="屏幕分辨率"></a>屏幕分辨率</h2><p>屏幕横纵方向上的像素点数，单位是px。1px = 1个像素点数。如1920*1080。</p><h2 id="屏幕像素密度"><a href="#屏幕像素密度" class="headerlink" title="屏幕像素密度"></a>屏幕像素密度</h2><p>每英寸上的像素点数，单位是dpi。即dot per inch。屏幕像素密度与屏幕尺寸和分辨率有关。</p><script type="math/tex; mode=display">像素密度 = \sqrt{ width^{2} + height^{2} } / 屏幕尺寸</script><h2 id="区分dpi和dip"><a href="#区分dpi和dip" class="headerlink" title="区分dpi和dip"></a>区分dpi和dip</h2><p>dpi是像素密度，全称是dot per inch。dip是密度无关像素，全称是density independence pixels。</p><h2 id="dip-dpi与px的转换"><a href="#dip-dpi与px的转换" class="headerlink" title="dip,dpi与px的转换"></a>dip,dpi与px的转换</h2><script type="math/tex; mode=display">px = dip * (dpi / 160)</script><p>比如：1dip在160dpi的屏幕上显示为1px，在320dpi的屏幕上显示为2px。</p><h1 id="屏幕适配"><a href="#屏幕适配" class="headerlink" title="屏幕适配"></a>屏幕适配</h1><h2 id="为什么要屏幕适配？"><a href="#为什么要屏幕适配？" class="headerlink" title="为什么要屏幕适配？"></a>为什么要屏幕适配？</h2><p>在不同尺寸的设备上，ui控件尺寸显示不一。比如：同样是5.0英寸的屏幕，在320dpi的屏幕上显示32px,在480dpi的屏幕上就显示为48px。前者看起来就会比后者尺寸大。</p><h2 id="适配后的效果"><a href="#适配后的效果" class="headerlink" title="适配后的效果"></a>适配后的效果</h2><p>ui控件在不同设备上显示的尺寸与屏幕的比例保持一致。</p><h2 id="如何适配"><a href="#如何适配" class="headerlink" title="如何适配"></a>如何适配</h2><p>这里使用的是开源框架<a href="https://github.com/JessYanCoding/AndroidAutoSize" target="_blank" rel="noopener">AndroidAutoSize</a>。</p><h3 id="添加依赖"><a href="#添加依赖" class="headerlink" title="添加依赖"></a>添加依赖</h3><pre><code class="lang-groovy">implementation &#39;me.jessyan:autosize:0.9.5&#39;</code></pre><h3 id="配置AndroidManifest-xml"><a href="#配置AndroidManifest-xml" class="headerlink" title="配置AndroidManifest.xml"></a>配置AndroidManifest.xml</h3><pre><code class="lang-xml">&lt;!-- 以宽或者高为基准，配置其一即可 --&gt;&lt;meta-data android:name=&quot;design_width_in_dp&quot;                 android:value=&quot;360&quot;/&gt;      &lt;meta-data android:name=&quot;design_height_in_dp&quot;                 android:value=&quot;640&quot;/&gt;</code></pre><p>如何去确定宽或者高的基准值？</p><p>在蓝湖中查看</p><p><img src="/img/lanhu_pixles.png" srcset="/img/loading.gif" alt="尺寸设置"></p><h3 id="框架原理"><a href="#框架原理" class="headerlink" title="框架原理"></a>框架原理</h3><p>源码中定义了<code>InitProvider</code>，继承自<code>ContentProvider</code>。并在<code>AndroidManifest.xml</code>中声明了<code>InitProvider</code>。</p><p>App启动时，会自动加载<code>InitProvider</code>。其<code>onCreate</code>方法就会被调用。</p><pre><code class="lang-java">@Override    public boolean onCreate() {        AutoSizeConfig.getInstance()                .setLog(true)                .init((Application) getContext().getApplicationContext())                .setUseDeviceSize(false);        return true;    }</code></pre><p><code>AutoSizeConfig</code>的<code>init</code>方法被调用。</p><pre><code class="lang-java">AutoSizeConfig init(final Application application, boolean isBaseOnWidth, AutoAdaptStrategy strategy) {       //省略不必要的代码。。。        final DisplayMetrics displayMetrics = Resources.getSystem().getDisplayMetrics();                //读取清单中配置的设计图的尺寸        getMetaData(application);              //通过WindowManager获取宽高        int[] screenSize = ScreenUtils.getScreenSize(application);        mScreenWidth = screenSize[0];        mScreenHeight = screenSize[1];                //和屏幕尺寸相关的初始值        mInitDensity = displayMetrics.density;        mInitDensityDpi = displayMetrics.densityDpi;        mInitScaledDensity = displayMetrics.scaledDensity;        mInitXdpi = displayMetrics.xdpi;        application.registerComponentCallbacks(new ComponentCallbacks() {            @Override            public void onConfigurationChanged(Configuration newConfig) {                if (newConfig != null) {                                     int[] screenSize = ScreenUtils.getScreenSize(application);                    mScreenWidth = screenSize[0];                    mScreenHeight = screenSize[1];                }            }            @Override            public void onLowMemory() {            }        });        mActivityLifecycleCallbacks = new ActivityLifecycleCallbacksImpl(strategy == null ? new DefaultAutoAdaptStrategy() : strategy);          //注册声明周期回调        application.registerActivityLifecycleCallbacks(mActivityLifecycleCallbacks);        return this;    }</code></pre><p><code>AutoSizeConfig</code>主要职责：</p><ol><li><p>获取和屏幕尺寸相关的属性值</p><pre><code class="lang-java"> /**     * 最初的 {@link DisplayMetrics#density}     */    private float mInitDensity = -1;    /**     * 最初的 {@link DisplayMetrics#densityDpi}     */    private int mInitDensityDpi;    /**     * 最初的 {@link DisplayMetrics#scaledDensity}     */    private float mInitScaledDensity;    /**     * 最初的 {@link DisplayMetrics#xdpi}     */    private float mInitXdpi;    /**     * 设计图上的总宽度, 单位 dp     */    private int mDesignWidthInDp;    //设计图上的总高度, 单位 dp         private int mDesignHeightInDp;    /**     * 设备的屏幕总宽度, 单位 px     */    private int mScreenWidth;    /**     * 设备的屏幕总高度, 单位 px, 如果 {@link #isUseDeviceSize} 为 {@code false}, 屏幕总高度会减去状态栏的高度     * 如果有导航栏也会减去导航栏的高度     */    private int mScreenHeight;</code></pre></li></ol><ol><li></li></ol><p>源码中有这样一个类<code>ActivityLifecycleCallbacksImpl</code>。这是<code>ActivityLifecycleCallbacks</code>的实现类。框架的入口就在类<code>ActivityLifecycleCallbacksImpl</code>的方法<code>onActivityCreated</code>。</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
